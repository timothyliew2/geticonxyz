<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- 动态标题和描述，根据语言切换 -->
    <title id="pageTitle">AppIcon - 高质量App图标下载平台</title>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3569373007781002" crossorigin="anonymous"></script>
    
    <!-- Google tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SCJ74BPRB7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-SCJ74BPRB7');
    </script>
    
    <!-- 中文SEO元标签 -->
    <meta name="description" content="AppIcon为设计师、开发者和营销人员提供高质量App图标下载服务。轻松获取iOS、Mac应用的官方Logo。" id="metaDescription">
    <meta name="keywords" content="app图标,logo下载,应用图标,设计资源,图标库,iOS图标,Android图标,高清图标,app icons,logo download,application icons,design resources,icon library,iOS icons,Android icons,high resolution icons" id="metaKeywords">
    <meta name="author" content="AppIcon">
    <meta name="robots" content="index, follow">
    
    <!-- 英文SEO优化 -->
    <link rel="canonical" href="https://yoursite.com/" id="canonicalLink">
    <link rel="alternate" hreflang="zh-CN" href="https://yoursite.com/">
    <link rel="alternate" hreflang="en" href="https://yoursite.com/en/">
    <link rel="alternate" hreflang="x-default" href="https://yoursite.com/">
    
    <!-- 地理位置信息 -->
    <meta name="geo.region" content="CN">
    <meta name="geo.placename" content="China">
    <meta name="geo.position" content="39.9042;116.4074">
    <meta name="ICBM" content="39.9042, 116.4074">
    
    <!-- 网站验证和安全 -->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- 性能和缓存优化 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="//itunes.apple.com">
    
    <!-- 内容安全策略 -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:; img-src 'self' https: data: blob:;">
    
    <!-- 搜索引擎优化 -->
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <meta name="revisit-after" content="7 days">
    <meta name="expires" content="never">
    
    <!-- Open Graph Meta Tags for Social Media -->
    <meta property="og:title" content="AppIcon - 高质量App图标下载平台" id="ogTitle">
    <meta property="og:description" content="为设计师、开发者和营销人员提供超过50万+iOS与Android应用的高清官方图标" id="ogDescription">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yoursite.com/">
    <meta property="og:site_name" content="AppIcon">
    <meta property="og:image" content="https://yoursite.com/images/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="AppIcon - High Quality App Icons Download Platform">
    <meta property="og:locale" content="zh_CN">
    <meta property="og:locale:alternate" content="en_US">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@AppIcon">
    <meta name="twitter:creator" content="@AppIcon">
    <meta name="twitter:title" content="AppIcon - 高质量App图标下载平台" id="twitterTitle">
    <meta name="twitter:description" content="为设计师、开发者和营销人员提供超过50万+iOS与Android应用的高清官方图标" id="twitterDescription">
    <meta name="twitter:image" content="https://yoursite.com/images/twitter-card.png">
    <meta name="twitter:image:alt" content="AppIcon - High Quality App Icons Download Platform">
    
    <!-- Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="AppIcon">
    
    <!-- Schema.org markup for Google -->
    <script type="application/ld+json" id="schemaMarkup">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "AppIcon",
      "alternateName": ["App Icon Downloader", "应用图标下载器"],
      "description": "AppIcon为设计师、开发者和营销人员提供高质量App图标下载服务。轻松获取iOS、Mac应用的官方Logo。",
      "url": "https://yoursite.com",
      "applicationCategory": "UtilitiesApplication",
      "operatingSystem": "Web browser",
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "softwareVersion": "1.0",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "reviewCount": "1250"
      },
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD",
        "availability": "https://schema.org/InStock"
      },
      "creator": {
        "@type": "Organization",
        "name": "AppIcon",
        "url": "https://yoursite.com"
      },
      "inLanguage": ["zh-CN", "en-US"],
      "audience": {
        "@type": "Audience",
        "audienceType": ["Designers", "Developers", "Marketers", "设计师", "开发者", "营销人员"]
      },
      "featureList": [
        "High-quality app icon downloads",
        "500,000+ iOS and Android app icons",
        "Multiple resolution support",
        "Batch download functionality",
        "Free to use",
        "高质量应用图标下载",
        "50万+iOS和Android应用图标",
        "多分辨率支持",
        "批量下载功能",
        "免费使用"
      ],
      "screenshot": "https://yoursite.com/images/screenshot.png",
      "image": "https://yoursite.com/images/app-logo-hd.png"
    }
    </script>
    
    <!-- 面包屑导航结构化数据 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://yoursite.com"
        }
      ]
    }
    </script>
    
    <!-- 网站搜索框结构化数据 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://yoursite.com",
      "name": "AppIcon",
      "alternateName": "App Icon Download Platform",
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://yoursite.com/search?q={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <!-- 组织信息结构化数据 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "AppIcon",
      "url": "https://yoursite.com",
      "logo": "https://yoursite.com/images/logo/app-logo-hd.png",
      "description": "Professional app icon download platform serving designers, developers, and marketers worldwide",
      "foundingDate": "2023",
      "sameAs": [
        "https://github.com/appicon",
        "https://twitter.com/appicon"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "availableLanguage": ["English", "Chinese"]
      }
    }
    </script>
    
    <!-- FAQ结构化数据 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "How to download app icons?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Simply search for the app name, click on the app icon you want, and then click the download button. You can download icons in multiple resolutions including 1024x1024, 512x512, and 100x100 pixels."
          }
        },
        {
          "@type": "Question",
          "name": "Are the app icons free to download?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, all app icons on our platform are free to download. We provide high-quality official app icons from iOS and Android applications."
          }
        },
        {
          "@type": "Question",
          "name": "What formats are available for download?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "All icons are available in PNG format with transparent backgrounds. We offer multiple resolutions: 1024x1024 (highest quality), 512x512, and 100x100 pixels."
          }
        },
        {
          "@type": "Question",
          "name": "Can I download multiple icons at once?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes, you can use our shopping cart feature to add up to 20 icons and download them all at once using the batch download functionality."
          }
        }
      ]
    }
    </script>
    
    <!-- 服务结构化数据 -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Service",
      "name": "App Icon Download Service",
      "description": "Professional app icon download service providing high-quality iOS and Android app icons",
      "provider": {
        "@type": "Organization",
        "name": "AppIcon"
      },
      "areaServed": "Worldwide",
      "availableChannel": {
        "@type": "ServiceChannel",
        "serviceUrl": "https://yoursite.com",
        "serviceSmsNumber": null,
        "servicePhone": null
      },
      "category": "Design Tools",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    
    <!-- Favicon 和设备图标 -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" href="favicon.ico">
    <meta name="theme-color" content="#6366f1">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 自定义Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                        secondary: {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            200: '#99f6e4',
                            300: '#5eead4',
                            400: '#2dd4bf',
                            500: '#14b8a6',
                            600: '#0d9488',
                            700: '#0f766e',
                            800: '#115e59',
                            900: '#134e4a',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-in-out',
                        'slide-down': 'slideDown 0.3s ease-in-out',
                        'bounce-light': 'bounceLight 2s infinite',
                        'pulse-light': 'pulseLight 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        bounceLight: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        pulseLight: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '.8' },
                        },
                    },
                }
      }
    }
    </script>
    
    <style>
        /* 自定义滚动条 */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        
        /* 加载动画 */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #f3f3f3;
            border-bottom-color: #6366f1;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        /* 图标卡片悬停效果 */
        .app-card {
            transition: all 0.3s ease;
        }
        
        .app-card:hover {
            transform: translateY(-5px);
        }
        
        /* 阻止图像拖动 */
        img {
            -webkit-user-drag: none;
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        /* 确保图像容器固定高度 */
        .icon-container {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 确保卡片底部对齐 */
        .app-card {
            display: flex;
            flex-direction: column;
        }
        
        .app-card .mt-auto {
            margin-top: auto;
        }
        
        /* 自定义淡入动画，确保动画结束后保持可见状态 */
        @keyframes fadeInPermanent {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .fade-in-permanent {
            animation: fadeInPermanent 0.5s ease-in-out forwards;
        }
        
        /* 圆角开关样式 */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        input:checked + .toggle-slider {
            background-color: #6366f1;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        /* Tailwind CSS的peer样式补充 */
        .peer:checked ~ .peer-checked\:bg-primary-600 {
            background-color: #6366f1;
        }
        
        .peer:checked ~ .peer-checked\:after\:translate-x-full::after {
            transform: translateX(100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 导航栏 -->
    <header class="bg-white shadow-sm fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="#" class="flex-shrink-0 flex items-center">
                        <img src="images/logo/app-logo-hd.png" alt="AppIcon Logo" class="w-8 h-8 mr-2 object-contain">
                        <span class="text-xl font-bold text-gray-900">AppIcon</span>
                    </a>
                    <nav class="hidden md:ml-10 md:flex md:space-x-8">
                        <a href="#" class="text-primary-600 border-primary-500 border-b-2 font-medium text-sm px-1 py-4" data-lang-key="nav.home">首页</a>
                        <a href="#" class="text-gray-500 hover:text-gray-900 font-medium text-sm px-1 py-4" data-lang-key="nav.popular">热门应用</a>
                        <a href="#" class="text-gray-500 hover:text-gray-900 font-medium text-sm px-1 py-4" data-lang-key="nav.categories">分类浏览</a>
                        <a href="#" class="text-gray-500 hover:text-gray-900 font-medium text-sm px-1 py-4" data-lang-key="nav.about">关于我们</a>
                </div>
                <div class="flex items-center"> 
                    <!-- 语言切换按钮 -->
                    <div class="mr-3">
                        <button id="langToggle" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md shadow-sm bg-white text-gray-700 hover:bg-gray-50 focus:outline-none">
                            <i class="fas fa-globe mr-2 text-gray-500"></i>
                            <span id="currentLang">中文</span>
                            <i class="fas fa-chevron-down ml-1 text-xs text-gray-500"></i>
                        </button>
                        <div id="langDropdown" class="absolute mt-1 bg-white shadow-lg rounded-md py-1 z-50 hidden">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-lang="zh-CN">中文</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-lang="en">English</a>
                        </div>
                    </div>
                    <div class="hidden md:ml-4 md:flex">
                        <button id="cartBtn" class="relative inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none ml-3">
                            <i class="fas fa-shopping-cart mr-2"></i> <span data-lang-key="cart.title">购物车</span>
                            <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                        </button>
                    </div>
                    <div class="ml-3 md:hidden">
                        <button id="mobileMenuButton" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100 focus:outline-none">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobileMenu" class="hidden md:hidden bg-white shadow-lg absolute w-full animate-slide-down">
            <div class="pt-2 pb-3 space-y-1 px-4">
                <a href="#" class="text-primary-600 font-medium block px-3 py-2 rounded-md text-base" data-lang-key="nav.home">首页</a>
                <a href="#" class="text-gray-500 hover:text-gray-900 hover:bg-gray-50 block px-3 py-2 rounded-md text-base font-medium" data-lang-key="nav.popular">热门应用</a>
                <a href="#" class="text-gray-500 hover:text-gray-900 hover:bg-gray-50 block px-3 py-2 rounded-md text-base font-medium" data-lang-key="nav.categories">分类浏览</a>
                <a href="#" class="text-gray-500 hover:text-gray-900 hover:bg-gray-50 block px-3 py-2 rounded-md text-base font-medium" data-lang-key="nav.about">关于我们</a>
                <div class="flex items-center px-3 py-2">
                    <button id="mobileLangToggle" class="flex items-center text-primary-600 font-medium">
                        <i class="fas fa-globe mr-2"></i> <span data-lang-key="language">语言</span>: <span id="mobileCurrentLang" class="ml-1">中文</span>
                    </button>
                </div>
                <a href="#" id="mobileCartBtn" class="flex items-center px-3 py-2 text-primary-600 font-medium">
                    <i class="fas fa-shopping-cart mr-2"></i> <span data-lang-key="cart.title">购物车</span> <span id="mobileCartCount" class="ml-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-10" role="main" itemScope itemType="https://schema.org/WebApplication">
        <!-- 搜索区域 -->
        <section class="mt-6 md:mt-10 max-w-4xl mx-auto" itemScope itemType="https://schema.org/SearchAction">
            <div class="bg-white shadow-md rounded-xl p-6 md:p-8">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-900 text-center mb-6" itemProp="headline">
                    <span data-lang-key="search.title.pre">获取高质量</span><span class="text-primary-600" data-lang-key="search.title.highlight">App图标</span><span data-lang-key="search.title.post">资源</span>
                </h1>
                <p class="text-gray-500 text-center mb-8 max-w-2xl mx-auto" data-lang-key="search.subtitle" itemProp="description">
                    为设计师、开发者和营销人员提供超过50万+iOS与Android应用的高清官方图标
                </p>
                
                <div class="relative max-w-2xl mx-auto">
                    <div class="flex items-center bg-gray-50 rounded-lg shadow-sm overflow-hidden border border-gray-200" role="search">
                        <input id="searchInput" type="search" placeholder="输入应用名称搜索..." data-lang-key="search.placeholder" data-lang-attr="placeholder" class="w-full px-4 py-3 text-gray-700 bg-transparent focus:outline-none" aria-label="Search for app icons" itemProp="query-input" />
                        <button id="searchBtn" class="flex-shrink-0 bg-primary-600 text-white px-6 py-3 rounded-r-lg hover:bg-primary-700 transition duration-200 focus:outline-none" type="submit" aria-label="Search">
                            <i class="fas fa-search mr-2" aria-hidden="true"></i><span data-lang-key="search.button">搜索</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 应用分类 -->
        <section class="mt-12" itemScope itemType="https://schema.org/ItemList">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900" data-lang-key="categories.title" itemProp="name">应用分类</h2>
                <a href="#" class="text-sm text-primary-600 hover:text-primary-700 font-medium flex items-center" aria-label="View all categories">
                    <span data-lang-key="categories.viewAll">查看全部</span> <i class="fas fa-chevron-right ml-1 text-xs" aria-hidden="true"></i>
                </a>
            </div>
            
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <a href="#" class="category-card bg-white shadow-sm rounded-xl p-4 text-center hover:shadow-md transition duration-200 hover:border-primary-200 border border-transparent">
                    <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mx-auto">
                        <i class="fas fa-gamepad text-primary-600"></i>
                    </div>
                    <h3 class="mt-2 text-sm font-medium text-gray-900" data-lang-key="categories.games">游戏</h3>
                    <p class="text-xs text-gray-500 mt-1" data-lang-key="categories.games.count">10,435个应用</p>
                </a>
                
                <a href="#" class="category-card bg-white shadow-sm rounded-xl p-4 text-center hover:shadow-md transition duration-200 hover:border-primary-200 border border-transparent">
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto">
                        <i class="fas fa-briefcase text-blue-600"></i>
                    </div>
                    <h3 class="mt-2 text-sm font-medium text-gray-900" data-lang-key="categories.business">办公</h3>
                    <p class="text-xs text-gray-500 mt-1" data-lang-key="categories.business.count">8,652个应用</p>
                </a>
                
                <a href="#" class="category-card bg-white shadow-sm rounded-xl p-4 text-center hover:shadow-md transition duration-200 hover:border-primary-200 border border-transparent">
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto">
                        <i class="fas fa-comments text-green-600"></i>
                    </div>
                    <h3 class="mt-2 text-sm font-medium text-gray-900" data-lang-key="categories.social">社交</h3>
                    <p class="text-xs text-gray-500 mt-1" data-lang-key="categories.social.count">5,243个应用</p>
                </a>
                
                <a href="#" class="category-card bg-white shadow-sm rounded-xl p-4 text-center hover:shadow-md transition duration-200 hover:border-primary-200 border border-transparent">
                    <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto">
                        <i class="fas fa-camera text-yellow-600"></i>
                    </div>
                    <h3 class="mt-2 text-sm font-medium text-gray-900" data-lang-key="categories.photo">摄影</h3>
                    <p class="text-xs text-gray-500 mt-1" data-lang-key="categories.photo.count">4,127个应用</p>
                </a>
                
                <a href="#" class="category-card bg-white shadow-sm rounded-xl p-4 text-center hover:shadow-md transition duration-200 hover:border-primary-200 border border-transparent">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto">
                        <i class="fas fa-music text-red-600"></i>
                    </div>
                    <h3 class="mt-2 text-sm font-medium text-gray-900" data-lang-key="categories.music">音乐</h3>
                    <p class="text-xs text-gray-500 mt-1" data-lang-key="categories.music.count">3,752个应用</p>
                </a>
                
                <a href="#" class="category-card bg-white shadow-sm rounded-xl p-4 text-center hover:shadow-md transition duration-200 hover:border-primary-200 border border-transparent">
                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto">
                        <i class="fas fa-ellipsis-h text-purple-600"></i>
                    </div>
                    <h3 class="mt-2 text-sm font-medium text-gray-900" data-lang-key="categories.more">更多分类</h3>
                    <p class="text-xs text-gray-500 mt-1" data-lang-key="categories.all">全部分类</p>
                </a>
            </div>
        </section>

        <!-- 搜索结果区域 -->
        <section id="searchResultsSection" class="mt-12 hidden">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-900"><span data-lang-key="search.results">搜索结果</span> <span id="searchQuery" class="text-primary-600"></span></h2>
                <div class="flex items-center space-x-3">
                    <select id="sortOptions" class="text-sm text-gray-700 border border-gray-300 rounded-md px-3 py-1.5 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                        <option value="relevance" data-lang-key="search.sort.relevance">相关性排序</option>
                        <option value="popularity" data-lang-key="search.sort.popularity">热门度排序</option>
                        <option value="name" data-lang-key="search.sort.name">名称排序</option>
                    </select>
                </div>
            </div>
            
            <div id="searchResults" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                <!-- 搜索结果将通过JavaScript动态生成 -->
            </div>
            
            <!-- 加载中状态 -->
            <div id="loadingIndicator" class="hidden py-10 flex items-center justify-center">
                <span class="loader"></span>
            </div>
            
            <!-- 没有结果提示 -->
            <div id="noResults" class="hidden py-16 text-center">
                <div class="text-gray-400 text-6xl mb-4">
                    <i class="far fa-sad-tear"></i>
                </div>
                <h3 class="text-xl font-medium text-gray-700 mb-2" data-lang-key="search.noResults.title">没有找到相关应用</h3>
                <p class="text-gray-500 max-w-md mx-auto" data-lang-key="search.noResults.message">
                    请尝试使用其他关键词搜索，或者浏览我们的热门应用和分类。
                </p>
                <button id="clearSearchBtn" class="mt-4 px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-200">
                    <i class="fas fa-arrow-left mr-2"></i><span data-lang-key="search.back">返回</span>
                </button>
            </div>
            
            <!-- 加载更多按钮 -->
            <div id="loadMoreContainer" class="mt-8 text-center hidden">
                <button id="loadMoreBtn" class="px-6 py-2.5 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition duration-200 shadow-sm">
                    <span data-lang-key="search.loadMore">加载更多</span> <i class="fas fa-chevron-down ml-2"></i>
                </button>
            </div>
        </section>
        
        <!-- 应用详情模态框 -->
        <div id="appDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden">
                <div class="flex justify-between items-center border-b border-gray-200 px-6 py-4">
                    <h3 class="text-lg font-medium text-gray-900" data-lang-key="detail.title">应用图标详情</h3>
                    <button id="closeDetailModal" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="overflow-y-auto p-6" style="max-height: calc(90vh - 70px);">
                    <div id="appDetailContent" class="flex flex-col md:flex-row">
                        <!-- 模态框内容将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 购物车模态框 -->
        <div id="cartModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <div class="flex justify-between items-center border-b border-gray-200 px-6 py-4">
                    <h3 class="text-lg font-medium text-gray-900">
                        <i class="fas fa-shopping-cart text-primary-600 mr-2"></i>
                        <span data-lang-key="cart.title">图标购物车</span> <span id="cartModalCount" class="text-primary-600">0</span><span>/20</span>
                    </h3>
                    <button id="closeCartModal" class="text-gray-500 hover:text-gray-700 focus:outline-none">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="overflow-y-auto p-6" style="max-height: calc(90vh - 70px - 80px);">
                    <div id="cartItems" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                        <!-- 购物车项目将通过JavaScript动态生成 -->
                    </div>
                    
                    <!-- 空购物车提示 -->
                    <div id="emptyCart" class="py-12 text-center">
                        <div class="text-gray-400 text-5xl mb-4">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <h3 class="text-xl font-medium text-gray-700 mb-2" data-lang-key="cart.empty.title">购物车为空</h3>
                        <p class="text-gray-500 max-w-md mx-auto" data-lang-key="cart.empty.message">
                            浏览应用并点击"加入购物车"按钮来添加图标，最多可添加20个图标。
                        </p>
                    </div>
                </div>
                
                <!-- 购物车底部操作栏 -->
                <div class="border-t border-gray-200 px-6 py-4 bg-gray-50">
                    <!-- 圆角设置区域 -->
                    <div class="mb-4 p-3 bg-white rounded-lg border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-magic text-primary-600"></i>
                                <label class="text-sm font-medium text-gray-700" data-lang-key="corner.title">圆角设置</label>
                                <div class="text-xs text-gray-500" data-lang-key="corner.subtitle">(苹果风格)</div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="cornerRadiusToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- 原有的操作按钮区域 -->
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <span data-lang-key="cart.selected">已选择</span> <span id="cartSelectedCount" class="font-medium text-gray-900">0</span> <span data-lang-key="cart.items">个图标</span>
                        </div>
                        <div class="flex space-x-3">
                            <button id="clearCartBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 text-sm font-medium" data-lang-key="cart.clear">
                                清空购物车
                            </button>
                            <button id="downloadAllBtn" class="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-download mr-2"></i> <span data-lang-key="cart.download">批量下载</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t border-gray-200 mt-12" role="contentinfo" itemScope itemType="https://schema.org/Organization">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="md:flex md:justify-between">
                <div class="mb-8 md:mb-0">
                    <a href="#" class="flex items-center" itemProp="url">
                        <img src="images/logo/app-logo-hd.png" alt="AppIcon Logo" class="w-8 h-8 mr-2 object-contain" itemProp="logo">
                        <span class="text-xl font-bold text-gray-900" itemProp="name">AppIcon</span>
                    </a>
                    <p class="text-gray-500 mt-2 max-w-md" data-lang-key="footer.description" itemProp="description">
                        AppIcon是一个帮助设计师、开发者和营销人员获取高质量应用图标资源的平台。
                    </p>
                </div>
                
                <div class="grid grid-cols-2 gap-8 sm:grid-cols-3">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase mb-4" data-lang-key="footer.quickLinks">快速链接</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="nav.home">首页</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="nav.popular">热门应用</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="nav.categories">分类浏览</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.favorites">收藏夹</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase mb-4" data-lang-key="footer.resources">资源</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.guide">使用指南</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.faq">常见问题</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.api">API文档</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.changelog">更新日志</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 tracking-wider uppercase mb-4" data-lang-key="footer.contact">联系我们</h3>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="nav.about">关于我们</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.feedback">反馈建议</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.contactInfo">联系方式</a></li>
                            <li><a href="#" class="text-gray-600 hover:text-primary-600" data-lang-key="footer.privacy">隐私政策</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 border-t border-gray-200 pt-8 flex flex-col md:flex-row md:justify-between md:items-center">
                <div class="flex space-x-6 md:order-2">
                    <a href="#" class="text-gray-400 hover:text-primary-600">
                        <i class="fab fa-weixin text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-primary-600">
                        <i class="fab fa-weibo text-xl"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-primary-600">
                        <i class="fab fa-github text-xl"></i>
                    </a>
                </div>
                <p class="mt-4 md:mt-0 md:order-1 text-sm text-gray-500">
                    &copy; 2023 AppIcon. <span data-lang-key="footer.rights">保留所有权利。</span>
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript 代码 -->
    <script>
        // 全局变量
        let currentPage = 1;
        let currentQuery = '';
        let currentResults = [];
        let isLoading = false;
        let hasMoreResults = true;
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        let cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
        const MAX_CART_ITEMS = 20;  // 购物车最大容量
        
        // 圆角设置相关变量
        let cornerRadiusEnabled = localStorage.getItem('cornerRadiusEnabled') === 'true';
        const APPLE_CORNER_RADIUS = 22.37; // 苹果图标标准圆角比例（约22.37%）
        
        // 语言配置
        let currentLang = 'zh-CN';
        
        // SEO内容配置
        const seoContent = {
            'zh-CN': {
                title: 'AppIcon - 高质量App图标下载平台',
                description: 'AppIcon为设计师、开发者和营销人员提供高质量App图标下载服务。轻松获取iOS、Mac应用的官方Logo。',
                keywords: 'app图标,logo下载,应用图标,设计资源,图标库,iOS图标,Android图标,高清图标',
                ogTitle: 'AppIcon - 高质量App图标下载平台',
                ogDescription: '为设计师、开发者和营销人员提供超过50万+iOS与Android应用的高清官方图标',
                schemaDescription: 'AppIcon为设计师、开发者和营销人员提供高质量App图标下载服务。轻松获取iOS、Mac应用的官方Logo。'
            },
            'en': {
                title: 'AppIcon - High Quality App Icons Download Platform',
                description: 'AppIcon provides high-quality app icon download services for designers, developers, and marketers. Easily get official logos from iOS and Mac applications.',
                keywords: 'app icons,logo download,application icons,design resources,icon library,iOS icons,Android icons,high resolution icons,mobile app icons,free icons',
                ogTitle: 'AppIcon - High Quality App Icons Download Platform',
                ogDescription: 'Providing over 500,000+ high-resolution official icons from iOS and Android apps for designers, developers, and marketers',
                schemaDescription: 'AppIcon provides high-quality app icon download services for designers, developers, and marketers. Easily get official logos from iOS and Mac applications.'
            }
        };
        
        const translations = {
            'zh-CN': {
                'nav.home': '首页',
                'nav.popular': '热门应用',
                'nav.categories': '分类浏览',
                'nav.about': '关于我们',
                'language': '语言',
                'cart.title': '购物车',
                'search.title.pre': '获取高质量',
                'search.title.highlight': 'App图标',
                'search.title.post': '资源',
                'search.subtitle': '为设计师、开发者和营销人员提供超过50万+iOS与Android应用的高清官方图标',
                'search.placeholder': '输入应用名称搜索...',
                'search.button': '搜索',
                'search.results': '搜索结果',
                'search.sort.relevance': '相关性排序',
                'search.sort.popularity': '热门度排序',
                'search.sort.name': '名称排序',
                'search.noResults.title': '没有找到相关应用',
                'search.noResults.message': '请尝试使用其他关键词搜索，或者浏览我们的热门应用和分类。',
                'search.back': '返回',
                'search.loadMore': '加载更多',
                'categories.title': '应用分类',
                'categories.viewAll': '查看全部',
                'categories.games': '游戏',
                'categories.games.count': '10,435个应用',
                'categories.business': '办公',
                'categories.business.count': '8,652个应用',
                'categories.social': '社交',
                'categories.social.count': '5,243个应用',
                'categories.photo': '摄影',
                'categories.photo.count': '4,127个应用',
                'categories.music': '音乐',
                'categories.music.count': '3,752个应用',
                'categories.more': '更多分类',
                'categories.all': '全部分类',
                'detail.title': '应用图标详情',
                'detail.download': '下载图标',
                'detail.appInfo': '应用信息',
                'detail.description': '描述',
                'detail.releaseDate': '发布日期',
                'detail.version': '版本',
                'detail.size': '大小',
                'detail.region': '区域',
                'cart.empty.title': '购物车为空',
                'cart.empty.message': '浏览应用并点击"加入购物车"按钮来添加图标，最多可添加20个图标。',
                'cart.selected': '已选择',
                'cart.items': '个图标',
                'cart.clear': '清空购物车',
                'cart.download': '批量下载',
                'cart.single.download': '下载',
                'cart.limit.message': '购物车已满！最多只能添加20个图标。',
                'cart.download.start': '即将开始下载',
                'cart.download.allow': '个图标，请允许浏览器下载多个文件。下载完成后将自动清空购物车。',
                'cart.download.complete': '所有图标下载完成，购物车已清空！',
                'cart.download.failed': '下载失败，请重试',
                'corner.title': '圆角设置',
                'corner.subtitle': '(苹果风格)',
                'footer.description': 'AppIcon是一个帮助设计师、开发者和营销人员获取高质量应用图标资源的平台。',
                'footer.quickLinks': '快速链接',
                'footer.favorites': '收藏夹',
                'footer.resources': '资源',
                'footer.guide': '使用指南',
                'footer.faq': '常见问题',
                'footer.api': 'API 文档',
                'footer.changelog': '更新日志',
                'footer.contact': '联系我们',
                'footer.feedback': '意见反馈',
                'footer.contactInfo': '联系方式',
                'footer.privacy': '隐私政策',
                'footer.rights': '保留所有权利。'
            },
            'en': {
                'nav.home': 'Home',
                'nav.popular': 'Popular Apps',
                'nav.categories': 'Categories',
                'nav.about': 'About Us',
                'language': 'Language',
                'cart.title': 'Cart',
                'search.title.pre': 'Get High-Quality ',
                'search.title.highlight': 'App Icons',
                'search.title.post': ' Resources',
                'search.subtitle': 'Providing over 500,000+ high-resolution official icons from iOS and Android apps for designers, developers, and marketers',
                'search.placeholder': 'Enter app name to search...',
                'search.button': 'Search',
                'search.results': 'Search Results',
                'search.sort.relevance': 'Sort by Relevance',
                'search.sort.popularity': 'Sort by Popularity',
                'search.sort.name': 'Sort by Name',
                'search.noResults.title': 'No Apps Found',
                'search.noResults.message': 'Try searching with different keywords, or browse our popular apps and categories.',
                'search.back': 'Back',
                'search.loadMore': 'Load More',
                'categories.title': 'App Categories',
                'categories.viewAll': 'View All',
                'categories.games': 'Games',
                'categories.games.count': '10,435 apps',
                'categories.business': 'Business',
                'categories.business.count': '8,652 apps',
                'categories.social': 'Social',
                'categories.social.count': '5,243 apps',
                'categories.photo': 'Photography',
                'categories.photo.count': '4,127 apps',
                'categories.music': 'Music',
                'categories.music.count': '3,752 apps',
                'categories.more': 'More Categories',
                'categories.all': 'All Categories',
                'detail.title': 'App Icon Details',
                'detail.download': 'Download Icon',
                'detail.appInfo': 'App Information',
                'detail.description': 'Description',
                'detail.releaseDate': 'Release Date:',
                'detail.version': 'Version:',
                'detail.size': 'Size:',
                'detail.region': 'Region:',
                'cart.empty.title': 'Cart is Empty',
                'cart.empty.message': 'Browse apps and click "Add to Cart" button to add icons. You can add up to 20 icons.',
                'cart.selected': 'Selected ',
                'cart.items': ' icons',
                'cart.clear': 'Clear Cart',
                'cart.download': 'Batch Download',
                'cart.single.download': 'Download',
                'cart.limit.message': 'Cart is full! You can add a maximum of 20 icons.',
                'cart.download.start': 'Starting to download ',
                'cart.download.allow': ' icons. Please allow your browser to download multiple files. The cart will be cleared after download is complete.',
                'cart.download.complete': 'All icons downloaded. Cart has been cleared!',
                'cart.download.failed': 'Download failed, please try again',
                'corner.title': 'Corner Radius',
                'corner.subtitle': '(Apple Style)',
                'footer.description': 'AppIcon is a platform helping designers, developers, and marketers access high-quality app icon resources.',
                'footer.quickLinks': 'QUICK LINKS',
                'footer.favorites': 'Favorites',
                'footer.resources': 'RESOURCES',
                'footer.guide': 'User Guide',
                'footer.faq': 'FAQ',
                'footer.api': 'API Docs',
                'footer.changelog': 'Changelog',
                'footer.contact': 'CONTACT US',
                'footer.feedback': 'Feedback',
                'footer.contactInfo': 'Contact Info',
                'footer.privacy': 'Privacy Policy',
                'footer.rights': 'All rights reserved.'
            }
        };
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 检测浏览器语言并设置初始语言
            detectBrowserLanguage();
            
            // 初始化UI元素事件
            initUIEvents();
            
            // 初始化搜索
            initSearch();
            
            // 初始化购物车
            initCart();
            
            // 初始化语言切换
            initLanguageSwitcher();
        });
        
        // 检测浏览器语言
        function detectBrowserLanguage() {
            // 先尝试从localStorage获取用户之前选择的语言
            const savedLang = localStorage.getItem('appIconLanguage');
            if (savedLang) {
                currentLang = savedLang;
            } else {
                // 获取浏览器语言
                const browserLang = navigator.language || navigator.userLanguage;
                
                // 检查是否为支持的语言，默认使用中文
                if (browserLang.startsWith('en')) {
                    currentLang = 'en';
                } else {
                    currentLang = 'zh-CN'; // 默认中文
                }
                
                // 保存到localStorage
                localStorage.setItem('appIconLanguage', currentLang);
            }
            
            // 应用翻译
            applyTranslations();
        }
        
        // 初始化语言切换
        function initLanguageSwitcher() {
            const langToggle = document.getElementById('langToggle');
            const langDropdown = document.getElementById('langDropdown');
            const currentLangElem = document.getElementById('currentLang');
            const mobileCurrentLangElem = document.getElementById('mobileCurrentLang');
            const mobileLangToggle = document.getElementById('mobileLangToggle');
            const langOptions = document.querySelectorAll('[data-lang]');
            
            // 设置当前语言显示
            if (currentLangElem) {
                currentLangElem.textContent = currentLang === 'zh-CN' ? '中文' : 'English';
            }
            
            if (mobileCurrentLangElem) {
                mobileCurrentLangElem.textContent = currentLang === 'zh-CN' ? '中文' : 'English';
            }
            
            // 桌面端语言切换按钮点击事件
            if (langToggle && langDropdown) {
                langToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    langDropdown.classList.toggle('hidden');
                });
                
                // 点击其他地方关闭下拉菜单
                document.addEventListener('click', () => {
                    if (!langDropdown.classList.contains('hidden')) {
                        langDropdown.classList.add('hidden');
                    }
                });
            }
            
            // 移动端语言切换按钮点击事件
            if (mobileLangToggle) {
                mobileLangToggle.addEventListener('click', () => {
                    // 切换到另一种语言
                    switchLanguage(currentLang === 'zh-CN' ? 'en' : 'zh-CN');
                });
            }
            
            // 语言选项点击事件
            langOptions.forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();
                    const lang = option.getAttribute('data-lang');
                    switchLanguage(lang);
                    langDropdown.classList.add('hidden');
                });
            });
        }
        
        // 切换语言
        function switchLanguage(lang) {
            if (lang !== currentLang && translations[lang]) {
                currentLang = lang;
                localStorage.setItem('appIconLanguage', lang);
                
                // 更新语言显示
                const currentLangElem = document.getElementById('currentLang');
                const mobileCurrentLangElem = document.getElementById('mobileCurrentLang');
                
                if (currentLangElem) {
                    currentLangElem.textContent = lang === 'zh-CN' ? '中文' : 'English';
                }
                
                if (mobileCurrentLangElem) {
                    mobileCurrentLangElem.textContent = lang === 'zh-CN' ? '中文' : 'English';
                }
                
                // 应用翻译
                applyTranslations();
            }
        }
        
        // 应用翻译
        function applyTranslations() {
            const elements = document.querySelectorAll('[data-lang-key]');
            
            elements.forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = translations[currentLang][key];
                
                if (translation) {
                    // 检查是否需要更新属性
                    const attrName = element.getAttribute('data-lang-attr');
                    if (attrName) {
                        element.setAttribute(attrName, translation);
                    } else {
                        element.textContent = translation;
                    }
                }
            });
            
            // 更新SEO内容
            updateSEOContent();
        }
        
        // 更新SEO内容
        function updateSEOContent() {
            const seo = seoContent[currentLang];
            if (!seo) return;
            
            // 更新页面标题
            document.title = seo.title;
            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) pageTitle.textContent = seo.title;
            
            // 更新meta描述
            const metaDescription = document.getElementById('metaDescription');
            if (metaDescription) metaDescription.setAttribute('content', seo.description);
            
            // 更新meta关键词
            const metaKeywords = document.getElementById('metaKeywords');
            if (metaKeywords) metaKeywords.setAttribute('content', seo.keywords);
            
            // 更新Open Graph标签
            const ogTitle = document.getElementById('ogTitle');
            if (ogTitle) ogTitle.setAttribute('content', seo.ogTitle);
            
            const ogDescription = document.getElementById('ogDescription');
            if (ogDescription) ogDescription.setAttribute('content', seo.ogDescription);
            
            // 更新Twitter Card标签
            const twitterTitle = document.getElementById('twitterTitle');
            if (twitterTitle) twitterTitle.setAttribute('content', seo.ogTitle);
            
            const twitterDescription = document.getElementById('twitterDescription');
            if (twitterDescription) twitterDescription.setAttribute('content', seo.ogDescription);
            
            // 更新HTML lang属性
            document.documentElement.lang = currentLang;
            
            // 更新Schema.org结构化数据
            updateSchemaMarkup();
        }
        
        // 更新Schema.org结构化数据
        function updateSchemaMarkup() {
            const seo = seoContent[currentLang];
            if (!seo) return;
            
            const schemaScript = document.getElementById('schemaMarkup');
            if (schemaScript) {
                const schemaData = {
                    "@context": "https://schema.org",
                    "@type": "WebApplication",
                    "name": "AppIcon",
                    "alternateName": currentLang === 'en' ? ["App Icon Downloader", "Icon Download Platform"] : ["应用图标下载器", "图标下载平台"],
                    "description": seo.schemaDescription,
                    "url": "https://yoursite.com",
                    "applicationCategory": "UtilitiesApplication",
                    "operatingSystem": "Web browser",
                    "browserRequirements": "Requires JavaScript. Requires HTML5.",
                    "softwareVersion": "1.0",
                    "aggregateRating": {
                        "@type": "AggregateRating",
                        "ratingValue": "4.8",
                        "reviewCount": "1250"
                    },
                    "offers": {
                        "@type": "Offer",
                        "price": "0",
                        "priceCurrency": "USD",
                        "availability": "https://schema.org/InStock"
                    },
                    "creator": {
                        "@type": "Organization",
                        "name": "AppIcon",
                        "url": "https://yoursite.com"
                    },
                    "inLanguage": [currentLang],
                    "audience": {
                        "@type": "Audience",
                        "audienceType": currentLang === 'en' ? 
                            ["Designers", "Developers", "Marketers", "UI/UX Designers", "Mobile App Developers"] :
                            ["设计师", "开发者", "营销人员", "UI/UX设计师", "移动应用开发者"]
                    },
                    "featureList": currentLang === 'en' ? [
                        "High-quality app icon downloads",
                        "500,000+ iOS and Android app icons",
                        "Multiple resolution support (1024x1024, 512x512, 100x100)",
                        "Batch download functionality",
                        "Free to use",
                        "Search functionality",
                        "Category browsing",
                        "Shopping cart feature"
                    ] : [
                        "高质量应用图标下载",
                        "50万+iOS和Android应用图标",
                        "多分辨率支持 (1024x1024, 512x512, 100x100)",
                        "批量下载功能",
                        "免费使用",
                        "搜索功能",
                        "分类浏览",
                        "购物车功能"
                    ],
                    "screenshot": "https://yoursite.com/images/screenshot.png",
                    "image": "https://yoursite.com/images/app-logo-hd.png"
                };
                
                schemaScript.textContent = JSON.stringify(schemaData, null, 2);
            }
        }
        
        // 初始化UI事件
        function initUIEvents() {
            // 移动端菜单切换
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    if (mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.remove('hidden');
                    } else {
                        mobileMenu.classList.add('hidden');
                    }
                });
            }
            
            // 模态框关闭按钮
            const closeDetailModal = document.getElementById('closeDetailModal');
            const appDetailModal = document.getElementById('appDetailModal');
            
            if (closeDetailModal && appDetailModal) {
                closeDetailModal.addEventListener('click', () => {
                    appDetailModal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                });
                
                // 点击模态框背景关闭
                appDetailModal.addEventListener('click', (e) => {
                    if (e.target === appDetailModal) {
                        appDetailModal.classList.add('hidden');
                        document.body.style.overflow = 'auto';
                    }
                });
            }
            
            // 主题切换
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }
            
            // 清除搜索按钮
            const clearSearchBtn = document.getElementById('clearSearchBtn');
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearSearch);
            }
            
            // 加载更多按钮
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', loadMoreResults);
            }
            
            // 排序选项
            const sortOptions = document.getElementById('sortOptions');
            if (sortOptions) {
                sortOptions.addEventListener('change', () => {
                    if (currentResults.length > 0) {
                        sortResults(sortOptions.value);
                        displayResults(currentResults);
                    }
                });
            }
        }
        
        // 初始化搜索功能
        function initSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            
            if (searchInput && searchBtn) {
                // 点击搜索按钮触发搜索
                searchBtn.addEventListener('click', () => {
                    const query = searchInput.value.trim();
                    if (query) {
                        performSearch(query);
                    }
                });
                
                // 回车键触发搜索
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const query = searchInput.value.trim();
                        if (query) {
                            performSearch(query);
                        }
                    }
                });
            }
        }
        
        // 执行搜索
        function performSearch(query) {
            if (isLoading || query === currentQuery) return;
            
            // 重置搜索状态
            currentPage = 1;
            currentQuery = query;
            currentResults = [];
            hasMoreResults = true;
            
            // 显示搜索结果区域
            const searchResultsSection = document.getElementById('searchResultsSection');
            const searchResults = document.getElementById('searchResults');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const noResults = document.getElementById('noResults');
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            const searchQueryElem = document.getElementById('searchQuery');
            
            if (searchResultsSection && searchResults && loadingIndicator && noResults) {
                searchResultsSection.classList.remove('hidden');
                searchResults.innerHTML = '';
                loadingIndicator.classList.remove('hidden');
                noResults.classList.add('hidden');
                loadMoreContainer.classList.add('hidden');
                
                if (searchQueryElem) {
                    searchQueryElem.textContent = `"${query}"`;
                }
                
                // 滚动到搜索结果区域
                searchResultsSection.scrollIntoView({ behavior: 'smooth' });
                
                // 执行API搜索
                searchApps(query);
            }
        }
        
        // API搜索应用
        async function searchApps(query) {
            isLoading = true;
            const loadingIndicator = document.getElementById('loadingIndicator');
            const noResults = document.getElementById('noResults');
            const searchResults = document.getElementById('searchResults');
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            
            try {
                // 构建API URL - iTunes Search API
                const limit = 20;
                // 同时查询中国区和美国区
                const cnApiUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=software&limit=${limit}&country=cn`;
                const usApiUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=software&limit=${limit}&country=us`;
                
                // 并行请求两个区域的数据
                const [cnResponse, usResponse] = await Promise.all([
                    fetch(cnApiUrl),
                    fetch(usApiUrl)
                ]);
                
                if (!cnResponse.ok || !usResponse.ok) {
                    throw new Error('网络请求失败');
                }
                
                // 获取数据
                const [cnData, usData] = await Promise.all([
                    cnResponse.json(),
                    usResponse.json()
                ]);
                
                // 合并结果并去重（根据trackId）
                let combinedResults = [...cnData.results];
                
                // 添加来源标记
                combinedResults.forEach(app => app.region = 'CN');
                
                // 添加美区结果并标记
                usData.results.forEach(usApp => {
                    usApp.region = 'US';
                    // 检查是否已存在相同应用（避免重复）
                    const existingApp = combinedResults.find(cnApp => cnApp.trackId === usApp.trackId);
                    if (!existingApp) {
                        combinedResults.push(usApp);
                    }
                });
                
                // 按相关性排序（可以根据需要调整排序逻辑）
                combinedResults.sort((a, b) => {
                    // 如果查询词完全匹配应用名称，提高其排序
                    const aNameMatch = a.trackName.toLowerCase().includes(query.toLowerCase());
                    const bNameMatch = b.trackName.toLowerCase().includes(query.toLowerCase());
                    
                    if (aNameMatch && !bNameMatch) return -1;
                    if (!aNameMatch && bNameMatch) return 1;
                    
                    // 默认排序逻辑
                    return b.averageUserRating - a.averageUserRating;
                });
                
                // 更新结果状态
                currentResults = combinedResults;
                hasMoreResults = combinedResults.length >= limit;
                
                // 隐藏加载指示器
                if (loadingIndicator) {
                    loadingIndicator.classList.add('hidden');
                }
                
                // 显示结果或没有结果提示
                if (combinedResults.length > 0) {
                    displayResults(combinedResults);
                    
                    // 显示加载更多按钮
                    if (hasMoreResults && loadMoreContainer) {
                        loadMoreContainer.classList.remove('hidden');
                    }
                } else {
                    if (noResults) {
                        noResults.classList.remove('hidden');
                    }
                    if (searchResults) {
                        searchResults.innerHTML = '';
                    }
                }
            } catch (error) {
                console.error('搜索失败:', error);
                
                // 显示错误提示
                if (searchResults) {
                    searchResults.innerHTML = `
                        <div class="col-span-full py-8 text-center">
                            <div class="text-red-500 mb-2"><i class="fas fa-exclamation-circle text-2xl"></i></div>
                            <h3 class="text-lg font-medium text-gray-700">搜索失败</h3>
                            <p class="text-gray-500">请检查网络连接后重试</p>
                        </div>
                    `;
                }
                
                // 隐藏加载指示器
                if (loadingIndicator) {
                    loadingIndicator.classList.add('hidden');
                }
            } finally {
                isLoading = false;
            }
        }
        
        // 显示搜索结果
        function displayResults(results) {
            const searchResults = document.getElementById('searchResults');
            
            if (searchResults) {
                // 清空现有结果
                if (currentPage === 1) {
                    searchResults.innerHTML = '';
                }
                
                // 创建结果卡片
                results.forEach((app, index) => {
                    const card = createAppCard(app, index);
                    searchResults.appendChild(card);
                });
                
                // 添加淡入动画，使用自定义的淡入类
                const cards = searchResults.querySelectorAll('.app-card');
                cards.forEach((card, i) => {
                    setTimeout(() => {
                        // 使用自定义淡入动画类而不是Tailwind的animate-fade-in
                        card.classList.add('fade-in-permanent');
                        // 直接设置最终的不透明度，确保动画结束后依然可见
                        card.style.opacity = '1';
                    }, i * 50);
                });
            }
        }
        
        // 创建应用卡片
        function createAppCard(app, index) {
            const card = document.createElement('div');
            card.className = 'app-card bg-white rounded-xl shadow-sm border border-gray-100 p-4 hover:shadow-md transition-all duration-300';
            card.dataset.appId = app.trackId;
            
            // 获取图标URL
            const iconUrl = app.artworkUrl512 || app.artworkUrl100;
            const isInCart = cartItems.some(item => item.trackId === app.trackId);
            
            const viewDetailsText = translations[currentLang]['detail.title'] || '查看详情';
            const regionLabel = app.region === 'US' ? (currentLang === 'en' ? 'US' : '美区') : '';
            
            card.innerHTML = `
                <div class="icon-container mb-3 relative">
                    <img src="${iconUrl}" alt="${app.trackName}" class="mx-auto w-24 h-24 rounded-xl object-cover shadow-sm" loading="lazy">
                    <button class="cart-btn absolute top-0 right-0 bg-white bg-opacity-70 hover:bg-opacity-100 rounded-full p-1.5 
                        ${isInCart ? 'text-primary-600' : 'text-gray-400 hover:text-primary-600'}" 
                        data-app-id="${app.trackId}" title="${isInCart ? (currentLang === 'en' ? 'Added to cart' : '已加入购物车') : (currentLang === 'en' ? 'Add to cart' : '加入购物车')}">
                        <i class="fas ${isInCart ? 'fa-check-circle' : 'fa-cart-plus'}"></i>
                    </button>
                    ${app.region === 'US' ? `<span class="absolute bottom-0 left-0 bg-blue-500 text-white text-xs px-2 py-0.5 rounded-br-lg rounded-tl-lg">${regionLabel}</span>` : ''}
                </div>
                <h3 class="font-medium text-gray-900 text-sm mb-1 line-clamp-1 text-center">${app.trackName}</h3>
                <p class="text-xs text-gray-500 mb-3 line-clamp-1 text-center">${app.artistName}</p>
                <button class="view-details-btn w-full text-xs bg-primary-50 text-primary-600 rounded-lg py-1.5 hover:bg-primary-100 transition mt-auto" data-app-id="${app.trackId}">
                    ${currentLang === 'en' ? 'View Details' : '查看详情'}
                </button>
            `;
            
            // 添加事件监听器
            card.querySelector('.view-details-btn').addEventListener('click', () => {
                showAppDetails(app);
            });
            
            // 购物车按钮事件
            card.querySelector('.cart-btn').addEventListener('click', (e) => {
                toggleCartItem(app, e.currentTarget);
                e.stopPropagation();
            });
            
            // 设置初始样式为不可见
            card.style.opacity = '0';
            
            return card;
        }
        
        // 显示应用详情
        function showAppDetails(app) {
            const appDetailModal = document.getElementById('appDetailModal');
            const appDetailContent = document.getElementById('appDetailContent');
            
            if (appDetailModal && appDetailContent) {
                // 获取最高质量图标
                const iconUrl = app.artworkUrl1024 || app.artworkUrl512 || app.artworkUrl100;
                const isInCart = cartItems.some(item => item.trackId === app.trackId);
                
                // 获取最高清尺寸信息
                let highestQualitySize = "1024x1024";
                if (app.artworkUrl1024) {
                    highestQualitySize = "1024x1024";
                } else if (app.artworkUrl512) {
                    highestQualitySize = "512x512";
                } else if (app.artworkUrl100) {
                    highestQualitySize = "100x100";
                } else {
                    highestQualitySize = currentLang === 'en' ? "Unknown size" : "未知尺寸";
                }
                
                // 翻译文本
                const detailDownloadText = translations[currentLang]['detail.download'] || '下载图标';
                const appInfoText = translations[currentLang]['detail.appInfo'] || '应用信息';
                const releaseDateText = translations[currentLang]['detail.releaseDate'] || '发布日期:';
                const versionText = translations[currentLang]['detail.version'] || '版本:';
                const sizeText = translations[currentLang]['detail.size'] || '大小:';
                const regionText = translations[currentLang]['detail.region'] || '区域:';
                const unknownText = currentLang === 'en' ? 'Unknown' : '未知';
                const viewInAppStoreText = currentLang === 'en' ? 'View in App Store' : '在App Store查看';
                const pngFormatText = currentLang === 'en' ? 'PNG Format | Highest Resolution' : 'PNG格式 | 最高清晰度';
                const regionLabel = app.region === 'US' ? (currentLang === 'en' ? 'US App' : '美区应用') : (currentLang === 'en' ? 'CN App' : '中国区应用');
                const regionValue = app.region === 'US' ? (currentLang === 'en' ? 'United States' : '美国') : (currentLang === 'en' ? 'China' : '中国');
                
                // 填充模态框内容
                appDetailContent.innerHTML = `
                    <div class="md:w-1/3 mb-6 md:mb-0 md:pr-6">
                        <div class="bg-gray-50 p-6 rounded-xl flex items-center justify-center relative">
                            <img src="${iconUrl}" alt="${app.trackName}" class="w-40 h-40 rounded-xl shadow-md">
                            <button class="cart-btn absolute top-3 right-3 bg-white rounded-full p-2 
                                ${isInCart ? 'text-primary-600' : 'text-gray-400 hover:text-primary-600'}" 
                                data-app-id="${app.trackId}" title="${isInCart ? (currentLang === 'en' ? 'Added to cart' : '已加入购物车') : (currentLang === 'en' ? 'Add to cart' : '加入购物车')}">
                                <i class="fas ${isInCart ? 'fa-check-circle' : 'fa-cart-plus'}"></i>
                            </button>
                            ${app.region === 'US' ? `<span class="absolute bottom-3 left-3 bg-blue-500 text-white text-xs px-2 py-1 rounded">${regionLabel}</span>` : ''}
                </div>
                        <div class="mt-4">
                            <h3 class="text-xl font-bold text-gray-900">${app.trackName}</h3>
                            <p class="text-gray-600 text-sm mb-2">${app.artistName}</p>
                            <div class="flex items-center text-sm text-gray-500 mb-4">
                                <span class="bg-gray-100 px-2 py-0.5 rounded text-xs mr-2">${app.primaryGenreName || (currentLang === 'en' ? 'App' : '应用')}</span>
                                <span>${app.averageUserRating ? `★ ${app.averageUserRating.toFixed(1)}` : ''}</span>
            </div>
                            <a href="${app.trackViewUrl}" target="_blank" class="inline-flex items-center text-sm text-primary-600 hover:text-primary-700">
                                <i class="fas fa-external-link-alt mr-1"></i> ${viewInAppStoreText}
                            </a>
        </div>
                    </div>
                    <div class="md:w-2/3">
                        <div class="bg-white shadow-sm border border-gray-200 rounded-xl p-5">
                            <h4 class="font-medium text-gray-900 mb-3">${detailDownloadText}</h4>
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-gray-800">${highestQualitySize}</div>
                                    <div class="text-sm text-gray-500">${pngFormatText}</div>
                                </div>
                                <button id="detailDownloadBtn" class="download-link px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center" data-url="${iconUrl}" data-filename="${app.trackName}_${highestQualitySize}.png">
                                    <i class="fas fa-download mr-2"></i> ${detailDownloadText}
            </button>
            </div>
        </div>
                        
                        <div class="mt-6 pt-6 border-t border-gray-200">
                            <h4 class="font-medium text-gray-900 mb-3">${appInfoText}</h4>
                            <div class="text-sm text-gray-600 space-y-3">
                                <p>${app.description ? app.description.substring(0, 200) + '...' : (currentLang === 'en' ? 'No description available' : '暂无描述')}</p>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <span class="text-gray-500">${releaseDateText}</span>
                                        <span>${new Date(app.releaseDate).toLocaleDateString()}</span>
            </div>
                                    <div>
                                        <span class="text-gray-500">${versionText}</span>
                                        <span>${app.version || unknownText}</span>
            </div>
                                    <div>
                                        <span class="text-gray-500">${sizeText}</span>
                                        <span>${formatFileSize(app.fileSizeBytes) || unknownText}</span>
        </div>
                                    <div>
                                        <span class="text-gray-500">${regionText}</span>
                                        <span>${regionValue}</span>
    </div>
        </div>
    </div>
                        </div>
                    </div>
                `;
                
                // 添加购物车按钮事件
                const cartBtn = appDetailContent.querySelector('.cart-btn');
                if (cartBtn) {
                    cartBtn.addEventListener('click', (e) => {
                        toggleCartItem(app, e.currentTarget);
                    });
                }
                
                // 添加下载按钮事件
                const downloadBtn = appDetailContent.querySelector('#detailDownloadBtn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', (e) => {
                        const url = e.currentTarget.dataset.url;
                        const filename = e.currentTarget.dataset.filename;
                        downloadSingleIcon(url, filename);
                    });
                }
                
                // 显示模态框
                appDetailModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }
        
        // 加载更多结果
        async function loadMoreResults() {
            if (isLoading || !hasMoreResults) return;
            
            currentPage++;
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            if (loadMoreBtn) {
                loadMoreBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> 加载中...';
                loadMoreBtn.disabled = true;
            }
            
            try {
                isLoading = true;
                
                // 构建API URL
                const limit = 20;
                const offset = (currentPage - 1) * limit;
                const apiUrl = `https://itunes.apple.com/search?term=${encodeURIComponent(currentQuery)}&entity=software&limit=${limit}&offset=${offset}&country=cn`;
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error('网络请求失败');
                }
                
                const data = await response.json();
                
                // 更新结果状态
                if (data.results.length > 0) {
                    // 添加新结果到当前结果集
                    currentResults = [...currentResults, ...data.results];
                    
                    // 显示新结果
                    displayResults(data.results);
                }
                
                // 检查是否还有更多结果
                hasMoreResults = data.results.length >= limit;
                
                // 更新加载更多按钮状态
                if (loadMoreBtn) {
                    if (hasMoreResults) {
                        loadMoreBtn.innerHTML = '加载更多 <i class="fas fa-chevron-down ml-2"></i>';
                        loadMoreBtn.disabled = false;
                    } else {
                        loadMoreBtn.innerHTML = '没有更多结果';
                        loadMoreBtn.disabled = true;
                    }
                }
                
                const loadMoreContainer = document.getElementById('loadMoreContainer');
                if (loadMoreContainer) {
                    loadMoreContainer.style.display = hasMoreResults ? 'block' : 'none';
                }
            } catch (error) {
                console.error('加载更多结果失败:', error);
                
                if (loadMoreBtn) {
                    loadMoreBtn.innerHTML = '加载失败，点击重试';
                    loadMoreBtn.disabled = false;
                }
            } finally {
                isLoading = false;
            }
        }
        
        // 清除搜索
        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchResultsSection = document.getElementById('searchResultsSection');
            
            if (searchInput) {
                searchInput.value = '';
            }
            
            if (searchResultsSection) {
                searchResultsSection.classList.add('hidden');
            }
            
            // 重置搜索状态
            currentPage = 1;
            currentQuery = '';
            currentResults = [];
            
            // 滚动到顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // 切换收藏状态
        function toggleFavorite(appId, button) {
            const index = favorites.indexOf(appId);
            
            if (index === -1) {
                // 添加到收藏
                favorites.push(appId);
                button.classList.add('text-yellow-500');
            } else {
                // 从收藏中移除
                favorites.splice(index, 1);
                button.classList.remove('text-yellow-500');
            }
            
            // 保存到本地存储
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
        
        // 排序结果
        function sortResults(sortBy) {
                if (!currentResults.length) return;
                
            switch (sortBy) {
                case 'name':
                    currentResults.sort((a, b) => a.trackName.localeCompare(b.trackName));
                    break;
                case 'popularity':
                    currentResults.sort((a, b) => (b.userRatingCount || 0) - (a.userRatingCount || 0));
                    break;
                case 'relevance':
                    // iTunes API已经按相关性排序，这里不需要额外操作
                    break;
                default:
                    break;
            }
        }
        
        // 文件大小格式化
        function formatFileSize(bytes) {
            if (!bytes) return '未知';
            
            bytes = parseInt(bytes);
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            if (bytes === 0) return '0 Byte';
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i), 2) + ' ' + sizes[i];
        }
        
        // 初始化购物车
        function initCart() {
            // 更新购物车计数
            updateCartCount();
            
            // 购物车按钮点击事件
            const cartBtn = document.getElementById('cartBtn');
            const mobileCartBtn = document.getElementById('mobileCartBtn');
            const cartModal = document.getElementById('cartModal');
            const closeCartModal = document.getElementById('closeCartModal');
            const clearCartBtn = document.getElementById('clearCartBtn');
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            
            // 显示购物车模态框
            if (cartBtn) {
                cartBtn.addEventListener('click', showCartModal);
            }
            
            if (mobileCartBtn) {
                mobileCartBtn.addEventListener('click', showCartModal);
            }
            
            // 关闭购物车模态框
            if (closeCartModal && cartModal) {
                closeCartModal.addEventListener('click', () => {
                    cartModal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                });
                
                // 点击模态框背景关闭
                cartModal.addEventListener('click', (e) => {
                    if (e.target === cartModal) {
                        cartModal.classList.add('hidden');
                        document.body.style.overflow = 'auto';
                    }
                });
            }
            
            // 清空购物车
            if (clearCartBtn) {
                clearCartBtn.addEventListener('click', clearCart);
            }
            
            // 批量下载
            if (downloadAllBtn) {
                downloadAllBtn.addEventListener('click', downloadAllIcons);
            }
            
            // 圆角开关事件监听器
            const cornerRadiusToggle = document.getElementById('cornerRadiusToggle');
            if (cornerRadiusToggle) {
                // 设置初始状态
                cornerRadiusToggle.checked = cornerRadiusEnabled;
                
                // 添加事件监听器
                cornerRadiusToggle.addEventListener('change', function() {
                    cornerRadiusEnabled = this.checked;
                    // 保存设置到本地存储
                    localStorage.setItem('cornerRadiusEnabled', cornerRadiusEnabled.toString());
                });
            }
        }
        
        // 显示购物车模态框
        function showCartModal() {
            const cartModal = document.getElementById('cartModal');
            const cartItems = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            
            if (cartModal && cartItems) {
                // 更新购物车内容
                renderCartItems();
                
                // 显示模态框
                cartModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }
        
        // 渲染购物车内容
        function renderCartItems() {
            const cartItemsContainer = document.getElementById('cartItems');
            const emptyCart = document.getElementById('emptyCart');
            
            if (cartItemsContainer && emptyCart) {
                // 清空现有内容
                cartItemsContainer.innerHTML = '';
                
                // 检查购物车是否为空
                if (cartItems.length === 0) {
                    emptyCart.classList.remove('hidden');
                    cartItemsContainer.classList.add('hidden');
                } else {
                    emptyCart.classList.add('hidden');
                    cartItemsContainer.classList.remove('hidden');
                    
                    // 创建购物车项目
                    cartItems.forEach(item => {
                        const iconUrl = item.artworkUrl512 || item.artworkUrl100;
                        const highestQualityUrl = item.artworkUrl1024 || item.artworkUrl512 || item.artworkUrl100;
                        
                        // 获取最高清尺寸信息
                        let highestQualitySize = "1024x1024";
                        if (item.artworkUrl1024) {
                            highestQualitySize = "1024x1024";
                        } else if (item.artworkUrl512) {
                            highestQualitySize = "512x512";
                        } else if (item.artworkUrl100) {
                            highestQualitySize = "100x100";
                        }
                        
                        const downloadText = translations[currentLang]['cart.single.download'] || '下载';
                        const regionLabel = item.region === 'US' ? 'US' : '';
                        
                        const cartItem = document.createElement('div');
                        cartItem.className = 'bg-white rounded-xl shadow-sm border border-gray-100 p-4 hover:shadow-md transition-all duration-300';
                        cartItem.dataset.appId = item.trackId;
                        
                        cartItem.innerHTML = `
                            <div class="relative mb-2">
                                <img src="${iconUrl}" alt="${item.trackName}" class="w-16 h-16 mx-auto rounded-xl object-cover shadow-sm">
                                <button class="remove-item-btn absolute -top-2 -right-2 bg-white rounded-full p-1 text-red-500 shadow-sm hover:bg-red-50" data-app-id="${item.trackId}">
                                    <i class="fas fa-times"></i>
                                </button>
                                ${item.region === 'US' ? `<span class="absolute -bottom-1 -left-1 bg-blue-500 text-white text-xs px-1 py-px rounded-full">${regionLabel}</span>` : ''}
                            </div>
                            <h3 class="text-xs font-medium text-gray-900 line-clamp-1 text-center mb-2">${item.trackName}</h3>
                            <button class="single-download-btn block w-full text-xs bg-gray-100 text-gray-600 rounded py-1 hover:bg-gray-200 transition text-center" data-url="${highestQualityUrl}" data-filename="${item.trackName}_${highestQualitySize}.png">
                                <i class="fas fa-download mr-1"></i> ${downloadText}
                            </button>
                        `;
                        
                        // 添加移除按钮事件
                        cartItem.querySelector('.remove-item-btn').addEventListener('click', () => {
                            removeFromCart(item.trackId);
                        });
                        
                        // 添加单个下载按钮事件
                        cartItem.querySelector('.single-download-btn').addEventListener('click', (e) => {
                            const url = e.currentTarget.dataset.url;
                            const filename = e.currentTarget.dataset.filename;
                            downloadSingleIcon(url, filename);
                        });
                        
                        cartItemsContainer.appendChild(cartItem);
                    });
                }
                
                // 更新计数
                document.getElementById('cartModalCount').textContent = cartItems.length;
                document.getElementById('cartSelectedCount').textContent = cartItems.length;
            }
        }
        
        // 切换购物车项目
        function toggleCartItem(app, button) {
            const appId = app.trackId;
            const isInCart = cartItems.some(item => item.trackId === appId);
            
            if (isInCart) {
                // 从购物车中移除
                removeFromCart(appId);
                    } else {
                // 添加到购物车
                addToCart(app);
            }
            
            // 更新按钮状态
            updateCartButtonState(appId, button);
        }
        
        // 添加到购物车
        function addToCart(app) {
            // 检查购物车是否已满
            if (cartItems.length >= MAX_CART_ITEMS) {
                const limitMessage = translations[currentLang]['cart.limit.message'] || `购物车已满！最多只能添加${MAX_CART_ITEMS}个图标。`;
                alert(limitMessage);
                return;
            }
            
            // 检查是否已在购物车中
            if (!cartItems.some(item => item.trackId === app.trackId)) {
                cartItems.push(app);
                
                // 保存到本地存储
                localStorage.setItem('cartItems', JSON.stringify(cartItems));
                
                // 更新购物车计数
                updateCartCount();
                
                // 更新所有相关按钮状态
                updateAllCartButtons(app.trackId, true);
            }
        }
        
        // 从购物车中移除
        function removeFromCart(appId) {
            const index = cartItems.findIndex(item => item.trackId === appId);
            
            if (index !== -1) {
                cartItems.splice(index, 1);
                
                // 保存到本地存储
                localStorage.setItem('cartItems', JSON.stringify(cartItems));
                
                // 更新购物车计数
                updateCartCount();
                
                // 更新所有相关按钮状态
                updateAllCartButtons(appId, false);
                
                // 如果当前在购物车模态框中，更新显示
                const cartModal = document.getElementById('cartModal');
                if (cartModal && !cartModal.classList.contains('hidden')) {
                    renderCartItems();
                }
            }
        }
        
        // 清空购物车
        function clearCart() {
            const confirmMessage = currentLang === 'en' ? 'Are you sure you want to clear the cart?' : '确定要清空购物车吗？';
            if (confirm(confirmMessage)) {
                // 保存旧的购物车项目ID以便更新按钮
                const oldIds = cartItems.map(item => item.trackId);
                
                // 清空购物车
                cartItems = [];
                
                // 保存到本地存储
                localStorage.setItem('cartItems', JSON.stringify(cartItems));
                
                // 更新购物车计数
                updateCartCount();
                
                // 更新购物车显示
                renderCartItems();
                
                // 更新所有相关按钮状态
                oldIds.forEach(id => {
                    updateAllCartButtons(id, false);
                });
            }
        }
        
        // 批量下载所有图标
        function downloadAllIcons() {
            if (cartItems.length === 0) {
                const emptyCartMessage = currentLang === 'en' ? 'Cart is empty. Please add icons before downloading.' : '购物车为空，请添加图标后再尝试下载。';
                alert(emptyCartMessage);
                return;
            }
            
            // 显示下载进度提示
            const startMessage = translations[currentLang]['cart.download.start'] || '即将开始下载';
            const allowMessage = translations[currentLang]['cart.download.allow'] || '个图标，请允许浏览器下载多个文件。下载完成后将自动清空购物车。';
            alert(`${startMessage}${cartItems.length}${allowMessage}`);
            
            // 保存当前购物车数量用于判断下载完成
            const totalItems = cartItems.length;
            let downloadedCount = 0;
            
            // 保存旧的购物车项目ID以便更新按钮
            const oldIds = cartItems.map(item => item.trackId);
            
            // 延迟执行下载，避免浏览器拦截
            setTimeout(() => {
                cartItems.forEach((item, index) => {
                    setTimeout(() => {
                        // 获取最高质量图标URL
                        const iconUrl = item.artworkUrl1024 || item.artworkUrl512 || item.artworkUrl100;
                        
                        // 获取最高清尺寸信息
                        let highestQualitySize = "1024x1024";
                        if (item.artworkUrl1024) {
                            highestQualitySize = "1024x1024";
                        } else if (item.artworkUrl512) {
                            highestQualitySize = "512x512";
                        } else if (item.artworkUrl100) {
                            highestQualitySize = "100x100";
                        }
                        
                        // 处理图片下载（支持圆角）
                        (async () => {
                            try {
                                let finalBlob;
                                let filename = `${item.trackName}_${highestQualitySize}.png`;
                                
                                if (cornerRadiusEnabled) {
                                    // 如果启用圆角，先处理图片
                                    finalBlob = await applyCornerRadius(iconUrl);
                                    filename = `${item.trackName}_${highestQualitySize}_rounded.png`;
                                } else {
                                    // 如果不启用圆角，直接获取原图
                                    const response = await fetch(iconUrl);
                                    finalBlob = await response.blob();
                                }
                                
                                // 创建Blob URL
                                const blobUrl = URL.createObjectURL(finalBlob);
                                
                                // 创建一个隐藏的a标签并触发下载
                                const a = document.createElement('a');
                                a.href = blobUrl;
                                a.download = filename;
                                a.style.display = 'none';
                                document.body.appendChild(a);
                                a.click();
                                
                                // 清理
                                setTimeout(() => {
                                    document.body.removeChild(a);
                                    URL.revokeObjectURL(blobUrl);
                                    
                                    // 计数下载完成的项目
                                    downloadedCount++;
                                    
                                    // 如果所有图标都已下载完成，清空购物车
                                    if (downloadedCount >= totalItems) {
                                        setTimeout(() => {
                                            // 清空购物车
                                            cartItems = [];
                                            
                                            // 保存到本地存储
                                            localStorage.setItem('cartItems', JSON.stringify(cartItems));
                                            
                                            // 更新购物车计数
                                            updateCartCount();
                                            
                                            // 更新购物车显示
                                            renderCartItems();
                                            
                                            // 更新所有相关按钮状态
                                            oldIds.forEach(id => {
                                                updateAllCartButtons(id, false);
                                            });
                                            
                                            // 显示提示
                                            const completeMessage = translations[currentLang]['cart.download.complete'] || '所有图标下载完成，购物车已清空！';
                                            alert(completeMessage);
                                            
                                            // 关闭购物车模态框
                                            const cartModal = document.getElementById('cartModal');
                                            if (cartModal && !cartModal.classList.contains('hidden')) {
                                                cartModal.classList.add('hidden');
                                                document.body.style.overflow = 'auto';
                                            }
                                        }, 500);
                                    }
                                }, 100);
                            } catch (error) {
                                console.error('下载图标失败:', error);
                                downloadedCount++; // 即使失败也计数，确保最终会清空购物车
                            }
                        })();
                    }, index * 300); // 每300ms下载一个，避免浏览器限制
                });
            }, 100);
        }
        
        // 圆角处理函数 - 使用苹果图标标准圆角
        function applyCornerRadius(imageUrl) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous'; // 处理跨域问题
                
                img.onload = function() {
                    // 创建Canvas元素
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 设置Canvas尺寸与图片相同
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // 计算苹果标准圆角半径
                    // 苹果图标使用连续曲线（squircle），这里用圆角矩形近似
                    const radius = Math.min(img.width, img.height) * (APPLE_CORNER_RADIUS / 100);
                    
                    // 绘制圆角矩形路径
                    ctx.beginPath();
                    ctx.moveTo(radius, 0);
                    ctx.lineTo(img.width - radius, 0);
                    ctx.quadraticCurveTo(img.width, 0, img.width, radius);
                    ctx.lineTo(img.width, img.height - radius);
                    ctx.quadraticCurveTo(img.width, img.height, img.width - radius, img.height);
                    ctx.lineTo(radius, img.height);
                    ctx.quadraticCurveTo(0, img.height, 0, img.height - radius);
                    ctx.lineTo(0, radius);
                    ctx.quadraticCurveTo(0, 0, radius, 0);
                    ctx.closePath();
                    
                    // 裁剪到圆角区域
                    ctx.clip();
                    
                    // 绘制图片
                    ctx.drawImage(img, 0, 0);
                    
                    // 转换为Blob
                    canvas.toBlob((blob) => {
                        if (blob) {
                            resolve(blob);
                        } else {
                            reject(new Error('转换图片失败'));
                        }
                    }, 'image/png', 1.0);
                };
                
                img.onerror = () => reject(new Error('加载图片失败'));
                img.src = imageUrl;
            });
        }

        // 单个图标下载
        async function downloadSingleIcon(url, filename) {
            try {
                let finalBlob;
                
                if (cornerRadiusEnabled) {
                    // 如果启用圆角，先处理图片
                    finalBlob = await applyCornerRadius(url);
                    // 修改文件名以标识圆角版本
                    filename = filename.replace('.png', '_rounded.png');
                } else {
                    // 如果不启用圆角，直接下载原图
                    const response = await fetch(url);
                    finalBlob = await response.blob();
                }
                
                // 创建下载链接
                const blobUrl = URL.createObjectURL(finalBlob);
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(blobUrl);
                }, 100);
            } catch (error) {
                console.error('下载图标失败:', error);
                const failedMessage = translations[currentLang]['cart.download.failed'] || '下载失败，请重试';
                alert(failedMessage);
            }
        }
        
        // 更新购物车计数
        function updateCartCount() {
            const cartCount = document.getElementById('cartCount');
            const mobileCartCount = document.getElementById('mobileCartCount');
            
            if (cartCount) {
                cartCount.textContent = cartItems.length;
            }
            
            if (mobileCartCount) {
                mobileCartCount.textContent = cartItems.length;
            }
            
            // 更新下载按钮状态
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            if (downloadAllBtn) {
                downloadAllBtn.disabled = cartItems.length === 0;
            }
        }
        
        // 更新按钮状态
        function updateCartButtonState(appId, button) {
            const isInCart = cartItems.some(item => item.trackId === appId);
            
            if (button) {
                if (isInCart) {
                    button.classList.add('text-primary-600');
                    button.classList.remove('text-gray-400', 'hover:text-primary-600');
                    button.innerHTML = '<i class="fas fa-check-circle"></i>';
                    button.title = '已加入购物车';
                } else {
                    button.classList.remove('text-primary-600');
                    button.classList.add('text-gray-400', 'hover:text-primary-600');
                    button.innerHTML = '<i class="fas fa-cart-plus"></i>';
                    button.title = '加入购物车';
                }
            }
        }
        
        // 更新所有相关按钮状态
        function updateAllCartButtons(appId, isInCart) {
            // 更新所有结果列表中的按钮
            const resultButtons = document.querySelectorAll(`.cart-btn[data-app-id="${appId}"]`);
            resultButtons.forEach(button => {
                updateCartButtonState(appId, button);
            });
        }
    </script>
</body>
</html>

        